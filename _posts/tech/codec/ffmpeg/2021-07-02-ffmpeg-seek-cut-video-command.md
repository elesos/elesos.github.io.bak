---
layout: post
title: FFmpeg 搜索与裁剪命令
date: 2021-07-02 21:27:19 +0800
categories: [艺搜科技,多媒体]
tags: [ffmpeg]
---
#### 快速定位

将ss放在-i的前面

```
ffmpeg -ss 00:23:00 -i input  -frames:v 1 out1.jpg
```

基于关键帧的搜索会非常快，现在新版也非常精确了！noaccurate_seek 选项可以用于查找前面最近的关键帧

#### 精确定位

将ss放在-i的后面

```
ffmpeg -i input.mkv -ss 00:23:00 -frames:v 1 out2.jpg
```

输入文件会一帧一帧地进行解码直到到达ss所指定的位置，因此会非常慢。指定时间越长，需要等待的时间也会越长。

#### 快速并且精确定位

在输入文件前后同时指定ss参数

```
ffmpeg -ss 00:22:30 -i input.mkv -ss 00:00:30 -frames:v 1 out3.jpg
```

综合了上面2种方法的优点。

首先快速定位到3分钟之前的某个时间点，然后从该时间点开始一帧一帧地慢慢解码到3分钟。

首先快速定位到00:02:30附近的关键帧处，然后开始慢慢往后搜索30秒。速度更快。

注意上面2个ss时间点(00:02:30和00:00:30)的设置依赖于关键帧的间隔（即GOP的大小）

#### 切割片断

将ss和t参数联合使用，其中t参数指定时长，例如“-ss 60 -t 10”将切割一段从60秒到70秒的片断；

或者使用to选项指定结束时间点，如“ -ss 60 -to 70”也一样切割一段从60秒到70秒的片断；t和to不能同时使用，如果同时指定，默认用t。

#### 注意

如果仅仅在-i之前指定了ss选项，那么时间戳会被重置为0，此时选项t和选项to产生的效果不一样。要保留原始时间戳，可以用-copyts选项(-c copy -copyts)

```
ffmpeg -ss 00:01:00 -i video.mp4 -to 00:02:00 -c copy cut.mp4 #得到从00:01:00 到 00:03:00的片断，不是想要的结果！
ffmpeg -i video.mp4 -ss 00:01:00 -to 00:02:00 -c copy cut.mp4  # 真正得到从00:01:00 到 00:02:00的片断。
ffmpeg -ss 00:01:00 -i video.mp4 -to 00:02:00 -c copy -copyts cut.mp4  //也是想要的结果，得到从00:01:00 到 00:02:00的片断，而且速度快
```

如果你切割的时候使用了流拷贝stream copy (-c copy)，并且想用 concat demuxer来合并你切割出来的片断，你需要指定`-avoid_negative_ts 1`:

```
ffmpeg -ss 00:03:00 -i video.mp4 -t 60 -c copy -avoid_negative_ts 1 cut.mp4
```

如果需要编码，比如得到120s开始的一分钟，则需要用-ss 120 -i some.mov -to 60，而不是-to 180

#### 时间格式

[HH:MM:SS]格式或以秒为单位，如00:02:30 或者 150。如果使用了小数，如02:30.05，小数点后面的05表示1秒*5%，即50毫秒 ，如02:30.5表示2分钟，30秒，500毫秒(即半秒)。

参考

http://trac.ffmpeg.org/wiki/Seeking